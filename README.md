# SNU Sugang Accum UI

서울대학교 수강신청 사이트(sugang.snu.ac.kr)의 **과목 목록을 안정적으로 누적 수집하고,  
선택적으로 과목 개요(국/영문)를 자동으로 가져와 CSV로 다운로드**하는  
Chrome 확장용 content script입니다.

> ⚠️ 주의  
> 이 프로젝트는 **개인 연구·데이터 분석 목적**으로 작성되었습니다.  
> 과도한 자동 요청은 서버에 부담을 줄 수 있으므로, 사용 시 적절한 딜레이 옵션을 권장합니다.

---

## 주요 기능 요약

- ✅ 페이지 단위 과목 목록 **누적 수집**
- ✅ **중복/누락 방지용 강력한 키 설계**  
  (`year + semester + deta + code + ltNo + sbjtSubhCd`)
- ✅ DOM 렌더링 안정화 후 추출 (race condition 방지)
- ✅ **반자동 / 자동 페이지 이동**
- ✅ 과목 개요(CC107 ajax) **병렬 수집**
- ✅ localStorage quota를 피하는 **CSV 직출력 모드 (기본값)**
- ✅ 누락 페이지 자동 재방문(revisit queue)
- ✅ 중간 중단 후 **자동 이어서 실행**

---

## 설치 방법

1. 이 저장소를 클론하거나 ZIP으로 다운로드
2. Chrome에서 `chrome://extensions` 접속
3. 우측 상단 **개발자 모드 ON**
4. **압축 해제된 확장 프로그램 로드**
5. 이 프로젝트 폴더 선택

---

## 사용 방법

### 1️⃣ 수강신청 페이지 접속

아래와 같은 **과목 목록이 나오는 페이지**에서 자동으로 UI가 주입됩니다.
https://sugang.snu.ac.kr/sugang/cc/cc100InterfaceSrch.action


화면 우측 하단에 **「수강 강좌 추출(누적기)」 UI**가 나타납니다.

---

## UI 버튼 설명

### 📌 기본 누적

- **이 페이지 누적(이동 없음)**  
  → 현재 페이지의 과목 10개(또는 마지막 페이지 잔여분)를 누적 저장

- **누적 + 다음 페이지(+1)**  
  → 현재 페이지 누적 후 다음 페이지로 이동

---

### 📌 반자동 / 자동 수집

- **반자동(개요): 다음 5페이지 / 20페이지**  
  → 페이지를 이동하며  
  - 과목 목록 누적
  - 각 페이지의 과목 개요(국/영문) 수집

- **자동(개요): 끝까지**  
  → 현재 페이지부터 **마지막 페이지까지 전부 자동 실행**  
  → 중간에 새로고침해도 이어서 실행됨

- **중단**  
  → 현재 실행 중인 자동/반자동 작업 중단

---

### 📌 CSV 다운로드

- **누적 CSV 받기**  
  → 지금까지 누적된 과목 목록을 CSV로 다운로드  
  (개요 포함 여부는 수집 여부에 따라 다름)

---

### 📌 개요 관련 (중요)

- **이 페이지 개요 수집(10개)**  
  → 현재 페이지의 과목 10개에 대해 개요(CC107)만 추가 수집

- **누적 전체 개요 채우기 (권장)**  
  → 지금까지 누적된 모든 과목 중  
  **개요가 비어 있는 항목만** 골라서 개요를 수집한 뒤  
  👉 **바로 CSV로 다운로드**

  ⚠️ 이 모드는 **localStorage에 중간 저장을 하지 않습니다**  
  (Chrome QuotaExceededError 방지 목적)

---

## CSV 파일 설명

### 📄 `sugang_accum_XXXX.csv`
- 과목 목록 누적 CSV
- 개요가 아직 수집되지 않았을 수 있음

### 📄 `sugang_with_summary_XXXX.csv`
- 과목 목록 + 개요(국문/영문) 포함
- **localStorage에 저장하지 않고 바로 생성**
- 대용량(수천 과목)에서도 안전

---

### CSV 컬럼 설명

| 컬럼명        | 설명                              |
| ------------- | --------------------------------- |
| pageNo        | 수집 당시 페이지 번호             |
| year          | 학년도                            |
| shtm          | 학기 코드                         |
| deta          | 세부 학기 코드                    |
| name          | 과목명                            |
| code          | 교과목 코드                       |
| ltNo          | 분반 번호                         |
| sbjtSubhCd    | 과목 하위 코드                    |
| prof          | 담당 교수                         |
| dept          | 개설 학과                         |
| codeText      | 화면 표시 코드 (예: 352.623(001)) |
| section       | 분반 문자열                       |
| applied       | 신청 인원                         |
| quota         | 정원                              |
| quotaResident | 재학생 정원                       |
| totalEnrolled | 총 수강 인원                      |
| credit        | 학점                              |
| timeRaw       | 강의 시간 문자열                  |
| tagText       | [전필]/[학사] 등 태그             |
| sbjtSmryKo    | 과목 개요 (국문)                  |
| sbjtSmryEn    | 과목 개요 (영문)                  |

---

## 자동화 설계 포인트 (기술 메모)

- **DOM 안정화 대기**
  - key 필드가 전부 채워질 때까지 반복 확인
- **중복 방지**
  - 모든 누적/인덱싱/개요 수집에서 동일한 키 규칙 사용
- **Revisit Queue**
  - 렌더링 실패/누락 페이지는 자동으로 재방문
  - 목표 개수 초과 시 revisit 자동 종료
- **Quota 안전 설계**
  - 대규모 개요 수집은 localStorage 저장을 기본 OFF
  - 결과는 CSV로만 산출

---

## 고급 / 응급용 (콘솔)

UI가 뜨지 않거나 버튼이 동작하지 않을 경우,
페이지 새로고침 후 **개발자도구 콘솔**에서 실행할 수 있습니다.

```js
window.collectSummariesForAccum?.({
  concurrency: 3,
  perItemDelayMs: 80
});
```

---

## 알려진 한계

- 수강신청 사이트 구조 변경 시 DOM selector 수정 필요

- 자동(개요) 모드는 서버 응답 속도에 따라 느릴 수 있음

- revisit은 목록 누락 보정용이며,
개요 누락은 “누적 전체 개요 채우기” 버튼을 권장

---

## 라이선스

개인 연구·학습 목적 자유 사용
(상업적 사용 및 서버 부하 유발 자동화는 권장하지 않음)
